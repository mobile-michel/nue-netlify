function F(x,j=document){return j.querySelector(x)}function J(x,j=document){return[...j.querySelectorAll(x)]}var K={},Q={};async function U(x){dispatchEvent(new Event("before:route"));let j=E(await C(x));await Z(j);let z=R(j);await b(z),q(j);let B=V(F("main"),F("main",j));V(F("body"),F("body",j),B),L(),W(x)}async function Z(x){let j=F("title",x)?.textContent;if(j)document.title=j;_("libs",x);for(let z of J("script[src]",x))await import(z.getAttribute("src"))}function _(x,j){F(`meta[name="${x}"]`)?.remove();let z=F(`meta[name="${x}"]`,j);if(z)F("head").appendChild(z)}function D(){let{hash:x}=location,j=x&&F(x),z=j?j.offsetTop-(parseInt(getComputedStyle(j).scrollMarginTop)||0):0;scrollTo(0,z)}function L(){dispatchEvent(new Event("route"));let[x,j]=location.pathname.split("/");dispatchEvent(new Event(`route:${j||"home"}`))}function N(x,j){x.addEventListener("click",(z)=>{let B=z.target.closest("[href]");if(!B)return;let G=B.getAttribute("href"),X=B.getAttribute("target"),Y=G?.split("/")?.pop()?.split(/[#?]/)?.shift();if(O(z,G,X,Y))return;if(G!=location.pathname)j(B.pathname,B);z.preventDefault()})}function O(x,j,z,B){return x.defaultPrevented||x.metaKey||x.ctrlKey||x.shiftKey||x.altKey||!j||j[0]=="#"||j.includes("//")||j.startsWith("mailto:")||B?.includes(".")&&!B.endsWith(".html")||!!z}function w(x){let j=location.pathname;return j.slice(0,j.lastIndexOf("/")+1)+x}function W(x,j="aria-current"){if(x[0]!="/")x=w(x);J(`[${j}]`).forEach((z)=>z.removeAttribute(j)),J("a").forEach((z)=>{if(!z.hash&&z.pathname==x)z.setAttribute(j,"page")})}function A(){if(!document.startViewTransition)document.startViewTransition=(x)=>x();history.pushState({path:location.pathname},0),addEventListener("scroll",()=>{K[location.pathname]=window.scrollY}),N(document,async(x,j)=>{let z=F("img",j);if(z)z.style.viewTransitionName="active-image";document.startViewTransition(async()=>{await U(x),history.pushState({path:x},0,x),D()})}),W(location.pathname),addEventListener("popstate",(x)=>{let{path:j}=x.state||{};if(j){let z=K[j];document.startViewTransition(async()=>{await U(j),scrollTo(0,z||0)})}})}function H(x,j){if(x.children.length!=j.children.length)return!1;for(let z=0;z<x.children.length;z++)if(x.children[z].tagName!=j.children[z].tagName)return!1;return!0}function V(x,j,z){if(!x||!j)return!0;if(x.className=j.className,H(x,j))return Array.from(x.children).forEach((B,G)=>{if(!(z&&B.tagName=="MAIN"))I(B,j.children[G])}),!0;else return x.innerHTML=j.innerHTML,!1}function I(x,j){if(x.outerHTML.replace(' aria-current="page"',"")!=j.outerHTML)x.replaceWith(j.cloneNode(!0))}function R(x){let j=T(J("link"),J("link",x));return j.forEach((z)=>F("head").appendChild(z)),j}function T(x,j){return x.forEach((z)=>{let B=z.getAttribute("href");z.disabled=!j.find((G)=>G.getAttribute("href")==B)}),j.filter((z)=>{let B=z.getAttribute("href");return!x.find((G)=>G.getAttribute("href")==B)})}function q(x){J("style").forEach((j)=>j.remove()),J("style",x).forEach((j)=>F("head").appendChild(j))}async function C(x){let j=Q[x];if(j)return j;let z=await fetch(x);if(j=await z.text(),z.status==404&&j?.trim()[0]!="<"){let B=document.title="Page not found";F("article").innerHTML=`<section><h1>${B}</h1></section>`}else Q[x]=j;return j}function E(x){return new DOMParser().parseFromString(x,"text/html")}async function b(x){let j=x.map((z)=>M(z.href));await Promise.all(j)}function M(x){return new Promise((j)=>{let z=document.createElement("link");z.rel="stylesheet",z.href=x,z.onload=j,F("head").appendChild(z)})}if(typeof window=="object")A();export{V as updateContent,w as toRelative,A as setupTransitions,W as setActive,N as onclick,U as loadPage,T as findNewStyles};
